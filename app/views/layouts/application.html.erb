<!DOCTYPE html>
<html class="h-100">
  <head>
    <title><%= content_for(:title) || "Rails Bulk Actionable" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Rails Bulk Actionable">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-body-secondary bg-gradient h-100 d-flex flex-column">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary lg-light mb-4 shadow-lg px-3 px-md-4">
      <a class="navbar-brand fw-bold" href="<%= root_path %>">
        <i class="bi bi-stack me-2 fs-5"></i>
        Rails Bulk Actionable
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarMain">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <%= link_to people_path, class: "nav-link" do %>
              <i class="bi bi-people me-1"></i>
              People
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to hobbies_path, class: "nav-link" do %>
              <i class="bi bi-heart me-1"></i>
              Hobbies
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to "https://github.com/qelphybox/rails_bulk_actionable", class: "nav-link ", target: "_blank", rel: "noopener" do %>
              <i class="bi bi-github me-1"></i>
              Source Code and Info
            <% end %>
          </li>
        </ul>
      </div>
    </nav>

    <main class="container-fluid flex-grow-1 px-3 px-md-4">
      <% if notice.present? %>
        <div class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
          <i class="bi bi-check-circle me-2 fs-5"></i>
          <%= notice %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>

      <% if alert.present? %>
        <div class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
          <i class="bi bi-exclamation-triangle me-2 fs-5"></i>
          <%= alert %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>
      <div class="row g-4">
        <div class="sticky-top col-lg-5">
          <div class="card shadow-sm border-0">
            <div class="card-body d-flex flex-column">
              <span class="badge bg-primary-subtle text-primary-emphasis mb-3">
                <i class="bi bi-lightning-charge-fill me-1"></i>
                BulkActionable Concern
              </span>

              <h1 class="h3 fw-bold mb-3">
                Bulk selection that survives pagination
              </h1>

              <p class="text-muted mb-3">
                In many Rails apps, users need to select records across several paginated pages
                (for example to delete, archive or export them), but the selection is lost as soon
                as you move to the next page or change filters.
              </p>

              <p class="text-muted mb-3">
                <code>BulkActionable</code> solves this by storing selected IDs in cache, scoped to
                the current session and controller. Users can freely navigate pages and contexts
                while keeping their bulk selection intact until an action is performed.
              </p>

              <ul class="text-muted small mb-3 ps-3">
                <li>Keep selections across paginated lists and filter changes</li>
                <li>Separate selections per resource and optional groups</li>
                <li>Stimulus controller for a smooth, modern UX</li>
                <li>Ready-to-use REST endpoints and controller helpers</li>
              </ul>

              <div class="mb-3">
                <h2 class="h6 mb-2 text-primary-emphasis">Usage Example</h2>
                <pre class="bg-light p-2 rounded small mb-2"><code>class PeopleController &lt; ApplicationController
  include BulkActionable

  private

  def bulk_action_scope
    Person.all
  end

  def bulk_action_id_param
    :id
  end
end
</code></pre>
                <pre class="bg-light p-2 rounded small mb-2"><code># config/routes.rb
Rails.application.routes.draw do
  concern :bulk_actionable do
    post :bulk_action_check, on: :collection
    post :bulk_action_uncheck, on: :collection
    post :bulk_action_check_all, on: :collection
    post :bulk_action_uncheck_all, on: :collection
  end

  resources :people, concerns: :bulk_actionable do
    delete :bulk_destroy, on: :collection
  end
end
</code></pre>
                <pre class="bg-light p-2 rounded small mb-2"><code>&lt;div
  data-controller="bulk-actionable"
  data-bulk-actionable-controller-path-value="&lt;%= people_path %&gt;"
  data-bulk-actionable-total-items-value="&lt;%= bulk_action_total_items %&gt;"
  data-bulk-actionable-selected-items-value="&lt;%= bulk_action_item_ids.to_a.to_json %&gt;"&gt;

  &lt;input
    type="checkbox"
    data-bulk-actionable-target="mainCheckbox"
    data-action="click->bulk-actionable#toggleMainCheckbox"&gt;

  &lt;div data-bulk-actionable-target="hideWhenSelected"&gt;
    &lt;%= button_to bulk_destroy_people_path, method: :delete, 
          class: "btn btn-danger" do %&gt;
      Delete Selected
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;% @people.each do |person| %&gt;
    &lt;input
      type="checkbox"
      data-bulk-actionable-target="itemCheckbox"
      data-id="&lt;%= person.id %&gt;"
      data-action="click->bulk-actionable#toggleItemCheckbox"&gt;
  &lt;% end %&gt;
&lt;/div&gt;
</code></pre>
                <div class="small text-muted">
                  See more in the <a href="https://github.com/qelphybox/rails_bulk_actionable" target="_blank" rel="noopener">README</a>.
                </div>
              </div>

              <div class="d-flex flex-wrap gap-2">

                <%= link_to "https://github.com/qelphybox/rails_bulk_actionable",
                            class: "btn btn-outline-secondary btn-sm",
                            target: "_blank", rel: "noopener" do %>
                  <i class="bi bi-github me-1"></i>
                  Docs on GitHub
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-7">
          <%= yield %>
        </div>
      </div>
    </main>

    <footer class="footer bg-light border-top py-4">
      <div class="container">
        <div class="row">
          <div class="col-md-6 mb-3 mb-md-0">
            <p class="text-muted mb-0">&copy; <%= Time.current.year %> Rails Bulk Actionable. All rights reserved.</p>
          </div>
          <div class="col-md-6 text-md-end">
            <p class="text-muted mb-0">
              Made with 
              <i class="bi bi-heart-fill text-danger"></i>
              and 
              <a href="https://getbootstrap.com/docs/5.3/getting-started/introduction/" target="_blank" rel="noopener" class="text-decoration-none">Bootstrap 5.3</a>
            </p>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09ZcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <%= javascript_importmap_tags %>
  </body>
</html>
